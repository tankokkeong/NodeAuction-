<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auctioneer Profile</title>

    <script src="script/signup.js"></script>

    <%- include("./common/plugins.ejs") %>

    <!-- Data tablets -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="style/myprofile.css">

    <!-- Script -->
    <script src="script/item-validation.js"></script>
</head>
<body>
    <%- include("./common/header.ejs") %>

    <div class="body-content">
        <div class="profile-container">
            <div class="row">

                <div class="col-lg-3 mb-3 myprofile-col">
                    <div class="bidder-profile-title mb-3">
                        <h1>Auctioneer Profile</h1>
                    </div>

                    <div class="list-group" id="list-tab" role="tablist">
                        <a class="list-group-item list-group-item-action active" id="list-home-list" data-toggle="list" href="#list-home" role="tab" aria-controls="home">
                            <i class="far fa-user mr-2"></i> Account Details
                        </a>

                        <a class="list-group-item list-group-item-action" id="list-profile-list" data-toggle="list" href="#list-profile" role="tab" aria-controls="profile">
                            <i class="fas fa-shopping-cart mr-2"></i> Auctioned Items
                        </a>

                        <a class="list-group-item list-group-item-action" id="list-post-auction" data-toggle="list" href="#list-auction-form" role="tab" aria-controls="profile">
                            <i class="fas fa-gavel mr-2"></i> Post Auction Item
                        </a>

                    </div>
                </div>

                <div class="col-lg-9 myprofile-col-1">
                  <div class="tab-content" id="nav-tabContent">

                    <div class="tab-pane fade show active" id="list-home" role="tabpanel" aria-labelledby="list-home-list">

                        <div class="profile-form-title mb-3">
                            <h2>Account Details</h2>
                        </div>

                        <form action="/edit-auctioneer" method="POST">
                            <div class="profile-form-container mt-3">
                                <div class="form-group row">
                                    <label for="inputEmail3" class="col-sm-2 col-form-label">Username</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="username" value="<%= userRecord.userName %>" name="username">
                                    </div>
                                </div>
            
                                <div class="tab-pane fade show active" id="list-home" role="tabpanel" aria-labelledby="list-home-list">
                                    <div class="form-group row">
                                        <label for="inputEmail3" class="col-sm-2 col-form-label">Full Name</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="full-name" value="<%= userRecord.fullName %>" name="full_name">
                                        </div>
                                    </div>
                                </div>
            
                                <div class="tab-pane fade show active" id="list-home" role="tabpanel" aria-labelledby="list-home-list">
                                    <div class="form-group row">
                                        <label for="inputEmail3" class="col-sm-2 col-form-label">Address Line 1</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="address-line-1" value="<%= userRecord.addressLine1 %>" name="address_line_1">
                                        </div>
                                    </div>
                                </div>
    
                                <div class="tab-pane fade show active" id="list-home" role="tabpanel" aria-labelledby="list-home-list">
                                    <div class="form-group row">
                                        <label for="inputEmail3" class="col-sm-2 col-form-label">Address Line 2</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="address-line-2" value="<%= userRecord.addressLine2 %>" name="address_line_2">
                                        </div>
                                    </div>
                                </div>
    
                                <div class="tab-pane fade show active" id="list-home" role="tabpanel" aria-labelledby="list-home-list">
                                    <div class="form-group row">
                                        <label for="inputEmail3" class="col-sm-2 col-form-label">City</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="city" value="<%= userRecord.city %>" name="city">
                                        </div>
                                    </div>
                                </div>
    
                                <div class="tab-pane fade show active" id="list-home" role="tabpanel" aria-labelledby="list-home-list">
                                    <div class="form-group row">
                                        <label for="inputEmail3" class="col-sm-2 col-form-label">Country</label>
                                        <div class="col-sm-10">
                                            <select class="form-control" id="country" name="country">
                                                <option>Select your country</option>
                                            </select>
                                        </div>
    
                                        <script>
                                            printCountry("country");
                                            selectCountry('<%= userRecord.country %>');
                                        </script>
                                    </div>
                                </div>
    
                                <div class="tab-pane fade show active" id="list-home" role="tabpanel" aria-labelledby="list-home-list">
                                    <div class="form-group row">
                                        <label for="inputEmail3" class="col-sm-2 col-form-label">Phone Number</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="phone-number" value="<%= userRecord.phone %>" name="phone_number">
                                        </div>
                                    </div>
                                </div>
    
                                <div class="text-left" id="changes-made" style="display: none;">
                                    <span class="text-success">Changes saved successfully !</span>
                                </div>
    
                                <div class="text-right">
                                    <button class="btn btn-dark" type="submit">Save Changes</button>
                                </div>
                            </div>
                        </form>
                        
                        <div class="profile-payment-method">
                            <div class="payment-method-title">
                                <h2>Cash Out Method</h2>
                            </div>

                            <div class="payment-method-container mt-3">
                                <button class="btn btn-dark" onclick="addPayment()">Add Payment</button>

                                <ul class="list-unstyled mt-3">
                                    <div class="text-info" id="no-payment">
                                        No payment method found
                                    </div>

                                    <li class="payment-row" id="payment-row" style="display: none;">
                                        <div class="payment-col">
                                            <img src="images/visa.png" class="mr-3" width="50px">
                                        </div>

                                        <div class="payment-col payment-card-num">
                                            1234 56XX XXXX 7890
                                        </div>

                                        <div class="payment-col payment-delete-btn">
                                            <button class="btn btn-danger" data-toggle="tooltip" data-placement="right" title="Delete" onclick="deletePayment()">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </li>

                                    <div class="text-success mt-3" id="payment-added" style="display: none;">
                                        Payment added successful!
                                    </div>

                                    <div class="text-danger mt-3" id="payment-deleted" style="display: none;">
                                        Payment deleted successful!
                                    </div>
                                </ul>
                            </div>
                        </div>
                    </div>


                    <div class="tab-pane fade" id="list-profile" role="tabpanel" aria-labelledby="list-profile-list">
                        <div class="payment-method-title mb-3">
                            <h2>Auctioned Records</h2>
                        </div>

                        <div class="alert alert-danger alert-dismissible fade show" role="alert" id="auction-alert" style="display: none;">
                            Item is successfully deleted!
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        <table class="table table-bordered" id="bidding-history-table">
                            <thead>
                                <tr class="bg-light">
                                    <th scope="col">Product</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Starting Price (USD)</th>
                                    <th scope="col">Auction Status</th>
                                    <th scope="col">Sold Price (USD)</th>
                                    <th scope="col">Payment Status</th>
                                    <th scope="col">Payment Date</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
        
                            <tbody id="bidding-list">
                                <% if (auctionedData.length > 0) { %>
                                    <% auctionedData.forEach(item => { %>
                                        <tr>
                                            <th scope='row' class='text-center'><img src='upload/<%= item.itemImage %>' width='100%'></th>
                                            <td><%= item.itemName %></td>
                                            <td>$ <%= item.startingPrice %></td>                                           
                                            <td><%= item.auctionStatus %></td>
                                            <td>$ <%= item.soldPrice %></td>
                                            <td><%= item.paymentStatus %></td>
                                            <td><%= item.paymentDate %></td>
                                            <td class='text-center'>
                                                <a href='product-info?item=<%= item.itemID %>' class='btn btn-primary mt-1'><i class="fas fa-eye"></i> View</a>

                                                <%if(item.auctionStatus != "Ended"){ %>
                                                <button onclick="confirmDeleteItem('<%= item.itemID %>')" class='btn btn-danger mt-1'><i class="fas fa-trash"></i> Delete</button>
                                                <%} %>
                                            </td>
                                        </tr>
                                    <% }) %>
                                <% } else { %>
                                    <div class="mt-3 mb-3 text-danger font-weight-bold">
                                        You do not have any auctioned item yet...
                                    </div>
                                <% } %>
                            </tbody>
                        </table>

                        <script>
                            $(document).ready( function () {
                                //Create new Datatable
                                $('#bidding-history-table').DataTable();

                            } );
                        </script>
                    </div>

                    <div class="tab-pane fade" id="list-auction-form" role="tabpanel" aria-labelledby="list-post-auction">
                        <div class="auction-form-container">
                            <div class="auction-form-title text-center mb-3 mt-3">
                                <h2>Auction Your Item</h2>
                            </div>

                            <div class="alert alert-success alert-dismissible fade show" role="alert" id="item-alert" style="display: none;">
                                Item is successfully posted !
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>

                            <form method="POST" action="/post-item" enctype="multipart/form-data" onsubmit="return postItemVerification()">
                                <div class="form-group row">
                                    <label for="inputPassword" class="col-sm-2 col-form-label">Item Image: </label>
                                    <div class="col-sm-10">
                                        <div class="auction-col">
                                            <input type="file" class="form-control" id="item-image" onchange="fileValidation('item-image')" name="file_upload">
                                            <span class="popover-dismiss" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" title="Reminder" data-content="Only the .jpg, .jpeg, and .png file formats are allowed">
                                                <i class="fas fa-question-circle question-mark"></i>
                                            </span>
                                        </div>
    
                                        <span class="text-danger error-prompt" style="display:none;"></span>
                                    </div>
                                </div>
    
                                <div class="form-group row">
                                    <label for="inputPassword" class="col-sm-2 col-form-label">Item Name: </label>
                                    <div class="col-sm-10">
                                        <div class="auction-col">
                                            <input type="text" class="form-control" id="item-name" name="item_name">
                                            <span class="popover-dismiss" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" title="Reminder" data-content="Your item name will represent your item and it should not be empty">
                                                <i class="fas fa-question-circle question-mark"></i>
                                            </span>
                                        </div>
    
                                        <span class="text-danger error-prompt" style="display:none;"></span>
                                    </div>
                                </div>
    
                                <div class="form-group row">
                                    <label for="inputPassword" class="col-sm-2 col-form-label">Item Description: </label>
                                    <div class="col-sm-10">
                                        <div class="auction-col">
                                            <textarea id="item-description" cols="30" rows="10" class="form-control" name="item_description"></textarea>
                                            <span class="popover-dismiss description-popover" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" title="Reminder" data-content="Your item description is used to describe the item and it should not be empty">
                                                <i class="fas fa-question-circle question-mark"></i>
                                            </span>
                                        </div>
    
                                        <span class="text-danger error-prompt" style="display:none;"></span>
                                    </div>
                                </div>
    
                                <div class="form-group row">
                                    <label for="inputPassword" class="col-sm-2 col-form-label">Item Retail Price: </label>
                                    <div class="col-sm-10">
                                        <div class="auction-col">
                                            <input type="number" class="form-control" id="item-retail-price" min="1" step="1" name="item_retail_price">
                                            <span class="popover-dismiss" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" title="Reminder" data-content="Your item price should not be lower than 1 and it should not be empty">
                                                <i class="fas fa-question-circle question-mark"></i>
                                            </span>
                                        </div>
    
                                        <span class="text-danger error-prompt" style="display:none;"></span>
                                    </div>
                                </div>
    
                                <div class="form-group row">
                                    <label for="inputPassword" class="col-sm-2 col-form-label">Item Starting Price: </label>
                                    <div class="col-sm-10">
                                        <div class="auction-col">
                                            <input type="number" class="form-control" id="item-starting-price" min="1" step="1" name="item_starting_price">
                                            <span class="popover-dismiss" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" title="Reminder" data-content="Your item starting price should not be lower than 1 and it should not be empty">
                                                <i class="fas fa-question-circle question-mark"></i>
                                            </span>
                                        </div>
    
                                        <span class="text-danger error-prompt" style="display:none;"></span>
                                    </div>
                                </div>
    
                                <div class="form-group row">
                                    <label for="inputPassword" class="col-sm-2 col-form-label">Minimun Price Per Bid: </label>
                                    <div class="col-sm-10">
                                        <div class="auction-col">
                                            <input type="number" class="form-control" id="price-per-bid" min="1" step="1" name="minimum_price_per_bid">
                                            <span class="popover-dismiss" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" title="Reminder" data-content="Your minimun price per bid should not be lower than 1 and it should not be empty">
                                                <i class="fas fa-question-circle question-mark"></i>
                                            </span>
                                        </div>
    
                                        <span class="text-danger error-prompt" style="display:none;"></span>
                                    </div>
                                </div>
    
                                <div class="form-group row">
                                    <label for="inputPassword" class="col-sm-2 col-form-label">Shipping & Handling Fee: </label>
                                    <div class="col-sm-10">
                                        <div class="auction-col">
                                            <input type="number" class="form-control" id="shipping-fee" min="1" step="1" name="shipping_fee">
                                            <span class="popover-dismiss" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" title="Reminder" data-content="Your shipping & handling fee should not be lower than 1 and it should not be empty">
                                                <i class="fas fa-question-circle question-mark"></i>
                                            </span>
                                        </div>
    
                                        <span class="text-danger error-prompt" style="display:none;"></span>
                                    </div>
                                </div>
    
                                <div class="form-group row">
                                    <label for="inputPassword" class="col-sm-2 col-form-label">Condition: </label>
                                    <div class="col-sm-10">
                                        <div class="auction-col">
                                            <select name="condition" id="condition" class="form-control" >
                                                <option value="First Hand">First Hand</option>
                                                <option value="Used">Used</option>
                                            </select>
                                            <span class="popover-dismiss" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" title="Reminder" data-content="The condition of the item is either first-hand or used">
                                                <i class="fas fa-question-circle question-mark"></i>
                                            </span>
                                        </div>
    
                                        <span class="text-danger error-prompt" style="display:none;"></span>
                                    </div>
                                </div>
    
                                <div class="form-group row">
                                    <label for="inputPassword" class="col-sm-2 col-form-label">Start Date: </label>
                                    <div class="col-sm-10">
                                        <div class="auction-col">
                                            <input type="datetime-local" name="start_date" id="start-date" class="form-control">
                                            <span class="popover-dismiss" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" title="Reminder" data-content="Start date represents the begining of the auction">
                                                <i class="fas fa-question-circle question-mark"></i>
                                            </span>
                                        </div>
                                        <span class="text-danger error-prompt" style="display:none;"></span>
                                    </div>
                                </div>
    
                                <div class="form-group row">
                                    <label for="inputPassword" class="col-sm-2 col-form-label">End Date: </label>
                                    <div class="col-sm-10">
                                        <div class="auction-col">
                                            <input type="datetime-local" name="end_date" id="end-date" class="form-control">
                                            <span class="popover-dismiss" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" title="Reminder" data-content="End date represents the begining of the auction">
                                                <i class="fas fa-question-circle question-mark"></i>
                                            </span>
                                        </div>
                                        <span class="text-danger error-prompt" style="display:none;"></span>
                                    </div>
                                </div>
    
                                <div class="text-center">
                                    <button class="btn btn-dark" type="submit">Submit</button>
                                </div>
                            </form>
                        </div>
                    </div>

                  </div>

                </div>
              </div>
        </div>
        
    </div>

    <%- include("./common/footer.ejs") %>
</body>
</html>

<script>
profileChanges();

$('.popover-dismiss').popover({
    trigger: 'focus'
})

function confirmDeleteItem(item_id){
    var confirmDelete = confirm("Are you sure you want to delete this item? It is irreversible!");

    if(confirmDelete){
        window.location.href = "delete-item/" + item_id;
    }

}

function AuctionnerProfileAlert(){
    var link = window.location.href.split("?")[1];
    var item_alert = document.getElementById("item-alert");
    var auction_alert = document.getElementById("auction-alert");

    if(link === "item-posted"){
        item_alert.style.display = "";

        //Switch to item tab
        document.getElementById("list-post-auction").click();
    }
    else if(link === "item-deleted"){
        auction_alert.style.display = "";

        //Switch to auctioned item tab
        document.getElementById("list-profile-list").click();
    }
}

AuctionnerProfileAlert();
</script>